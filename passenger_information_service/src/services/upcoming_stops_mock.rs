
use itxpt::{
    expected_call::ExpectedCall, 
    vehicle_journey_details::VehicleJourneyDetails, 
    vehicle_state::VehicleState,
};
use crate::services::upcoming_stops::data_handler::DataHandler;

use log::{info, error};
use std::sync::{Arc, Mutex};

use super::upcoming_stops::simple_http_endpoint::SimpleHttpEndpoint;


pub struct UpcomingStopsMock {
    data_handler: Arc<Mutex<DataHandler>>,
    endpoint: SimpleHttpEndpoint,
}


impl UpcomingStopsMock {
    pub fn new () -> Self {
        UpcomingStopsMock {
            data_handler: Arc::new(Mutex::new(DataHandler::new())),
            endpoint: SimpleHttpEndpoint::new(),
        }
    }
    
    pub fn start_mock_mqtt(&mut self) {
        let handler_lock = self.data_handler.lock();
        match handler_lock {
            Ok(mut handler) => {
                let expected_call: Result<ExpectedCall, serde_json::Error> = serde_json::from_str(&UpcomingStopsMock::GPT_EXPECTED_CALLS_MQTT_MSG);
                let expected_call = expected_call.unwrap();
                handler.set_expected_calls(expected_call);

                let vehicle_journey_details: Result<VehicleJourneyDetails, serde_json::Error> = serde_json::from_str(&UpcomingStopsMock::GPT_VEHICLE_JOURNEY_MQTT_MSG);
                let vehicle_journey_details = vehicle_journey_details.unwrap();
                handler.set_vehicle_journey_details(vehicle_journey_details);

                let vehicle_state: Result<VehicleState, serde_json::Error> = serde_json::from_str(&UpcomingStopsMock::GPT_DISPLAY_MODE_MSG);
                let vehicle_state = vehicle_state.unwrap();
                handler.set_vehicle_state(vehicle_state);
            }
            Err(e) => {
                error!("Failed to lock data handler {e:?}");
            }
        }
        info!("Converted ITxPT messags to GPT messages.")
    }
    
    pub fn start_server(&mut self) {
        self.endpoint.start_server(8080, &self.data_handler);
    }
    
    const GPT_DISPLAY_MODE_MSG: &str = "{\"_displayMode\":\"Normal\",\"_eventId\":\"5ef01976-156d-470c-92a6-2065d6981709\",\"_eventType\":\"mi/tdp/state\",\"_sequenceNumber\":11}";
    const GPT_VEHICLE_JOURNEY_MQTT_MSG: &str = "{\"operatingDayDate\":\"2023-01-12T00:00:00\",\"vehicleJourneyRef\":\"9015005000300065\",\"journeyNumber\":\"65\",\"transportModeCode\":\"TRAM\",\"transportAuthority\":{\"ref\":\"9010005000000000\",\"code\":\"OTN\",\"name\":\"Östgötatrafiken\",\"number\":\"5\"},\"plannedStartDateTime\":\"2023-01-12T09:14:00Z\",\"plannedEndDateTime\":\"2023-01-12T09:49:00Z\",\"origin\":{\"name\":\"Vidablick\"},\"line\":{\"ref\":\"9011005000300000\",\"designation\":\"3\",\"number\":\"9011005000300000\"},\"directionOfLine\":{\"code\":\"1\",\"name\":\"\"},\"calls\":[{\"sequenceNumber\":1,\"journeyPatternPoint\":{\"isTimingPoint\":true},\"stopArea\":{\"ref\":\"9021005000012000\",\"name\":\"Vidablick\"},\"stopPoint\":{\"ref\":\"9022005000012016\",\"name\":\"Vidablick\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:14:00Z\",\"arrivalType\":\"STOP_NO_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:14:00Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":2,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001039000\",\"name\":\"Rågången\"},\"stopPoint\":{\"ref\":\"9022005001039016\",\"name\":\"Rågången\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:14:56Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:14:56Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":3,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001038000\",\"name\":\"Sandbyhov\"},\"stopPoint\":{\"ref\":\"9022005001038016\",\"name\":\"Sandbyhov\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:16:10Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:16:10Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":4,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001037000\",\"name\":\"Breda vägen\"},\"stopPoint\":{\"ref\":\"9022005001037016\",\"name\":\"Breda vägen\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:17:36Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:17:36Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":5,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000006000\",\"name\":\"Hagaskolan\"},\"stopPoint\":{\"ref\":\"9022005000006016\",\"name\":\"Hagaskolan\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:19:12Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:19:12Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":6,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001020000\",\"name\":\"Marielund\"},\"stopPoint\":{\"ref\":\"9022005001020016\",\"name\":\"Marielund\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:20:36Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:20:36Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":7,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001002000\",\"name\":\"Matteusskolan\"},\"stopPoint\":{\"ref\":\"9022005001002016\",\"name\":\"Matteusskolan\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:22:01Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:22:01Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":8,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000001000\",\"name\":\"Norr Tull\"},\"stopPoint\":{\"ref\":\"9022005000001016\",\"name\":\"Norr Tull\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:23:36Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:23:36Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":9,\"journeyPatternPoint\":{\"isTimingPoint\":true},\"stopArea\":{\"ref\":\"9021005001000000\",\"name\":\"Norrköpings resecentrum\"},\"stopPoint\":{\"ref\":\"9022005001000016\",\"name\":\"Norrköpings resecentrum\",\"designation\":\"D1\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:26:00Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:26:00Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":10,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000005000\",\"name\":\"Rådhuset\"},\"stopPoint\":{\"ref\":\"9022005000005016\",\"name\":\"Rådhuset\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:28:29Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:28:29Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":11,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000011000\",\"name\":\"Hörsalsparken\"},\"stopPoint\":{\"ref\":\"9022005000011016\",\"name\":\"Hörsalsparken\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:31:00Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:31:00Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":12,\"journeyPatternPoint\":{\"isTimingPoint\":true},\"stopArea\":{\"ref\":\"9021005000003000\",\"name\":\"Söder Tull\"},\"stopPoint\":{\"ref\":\"9022005000003018\",\"name\":\"Söder Tull\",\"designation\":\"H\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:33:00Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:34:00Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":13,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000008000\",\"name\":\"Väster Tull\"},\"stopPoint\":{\"ref\":\"9022005000008016\",\"name\":\"Väster Tull\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:36:26Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:36:26Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":14,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001027000\",\"name\":\"Strömbacken\"},\"stopPoint\":{\"ref\":\"9022005001027016\",\"name\":\"Strömbacken\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:37:42Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:37:42Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":15,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001029000\",\"name\":\"Vägträffen\"},\"stopPoint\":{\"ref\":\"9022005001029016\",\"name\":\"Vägträffen\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:39:00Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:39:00Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":16,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001030000\",\"name\":\"Lokegatan\"},\"stopPoint\":{\"ref\":\"9022005001030016\",\"name\":\"Lokegatan\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:40:36Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:40:36Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":17,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001031000\",\"name\":\"Skarphagsgatan\"},\"stopPoint\":{\"ref\":\"9022005001031016\",\"name\":\"Skarphagsgatan\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:41:29Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:41:29Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":18,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005000009000\",\"name\":\"Folkets Park\"},\"stopPoint\":{\"ref\":\"9022005000009016\",\"name\":\"Folkets Park\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:42:36Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:42:36Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":19,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001032000\",\"name\":\"SMHI\"},\"stopPoint\":{\"ref\":\"9022005001032016\",\"name\":\"SMHI\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:43:34Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:43:34Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":20,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001033000\",\"name\":\"Bastuban\"},\"stopPoint\":{\"ref\":\"9022005001033016\",\"name\":\"Bastuban\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:45:01Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:45:01Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":21,\"journeyPatternPoint\":{\"isTimingPoint\":false},\"stopArea\":{\"ref\":\"9021005001034000\",\"name\":\"Klockaretorpets centrum\"},\"stopPoint\":{\"ref\":\"9022005001034016\",\"name\":\"Klockaretorpets centrum\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:46:09Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:46:09Z\",\"departureType\":\"STOP_IF_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}},{\"sequenceNumber\":22,\"journeyPatternPoint\":{\"isTimingPoint\":true},\"stopArea\":{\"ref\":\"9021005000010000\",\"name\":\"Klockaretorpets vändplats\"},\"stopPoint\":{\"ref\":\"9022005000010016\",\"name\":\"Klockaretorpets vändplats\",\"designation\":\"A\"},\"arrival\":{\"latestDateTime\":\"2023-01-12T09:49:00Z\",\"arrivalType\":\"STOP_IF_ALIGHTING\"},\"departure\":{\"earliestDateTime\":\"2023-01-12T09:49:00Z\",\"departureType\":\"STOP_NO_BOARDING\"},\"destinationDisplay\":{\"lineDesignation\":\"3\",\"primaryDestination\":{\"name\":\"Klockaretorpet\"}}}],\"gtfsShapeId\":\"2055700000054710291\",\"gtfsTripId\":\"55700000066530291\",\"gptShapeHash\":\"336DB33F6783B37540A78C70CA4165E1\",\"journeyPath\":[[58.608558654785156,16.151491165161133],[58.60854721069336,16.151491165161133],[58.608089447021484,16.152175903320312],[58.607383728027344,16.153200149536133],[58.60657501220703,16.154396057128906],[58.604881286621094,16.156909942626953],[58.60476303100586,16.15709686279297],[58.6047248840332,16.157182693481445],[58.604652404785156,16.15738868713379],[58.604610443115234,16.157577514648438],[58.60457229614258,16.15778350830078],[58.60456085205078,16.158109664916992],[58.60459518432617,16.158935546875],[58.60472869873047,16.162206649780273],[58.604740142822266,16.16251564025879],[58.60472869873047,16.162687301635742],[58.60470962524414,16.162790298461914],[58.60464859008789,16.163047790527344],[58.6046028137207,16.16316795349121],[58.60453796386719,16.163270950317383],[58.60445022583008,16.163389205932617],[58.604339599609375,16.163475036621094],[58.604225158691406,16.163524627685547],[58.60354995727539,16.16351890563965],[58.60343551635742,16.16349983215332],[58.60334396362305,16.16346549987793],[58.60310363769531,16.163358688354492],[58.60293960571289,16.163288116455078],[58.602813720703125,16.163236618041992],[58.60189437866211,16.162487030029297],[58.600746154785156,16.161357879638672],[58.600379943847656,16.160974502563477],[58.600101470947266,16.160680770874023],[58.59996795654297,16.160541534423828],[58.59990310668945,16.16048812866211],[58.59983444213867,16.160470962524414],[58.59977722167969,16.160503387451172],[58.599708557128906,16.16058921813965],[58.59964370727539,16.16072654724121],[58.59943771362305,16.161394119262695],[58.59942626953125,16.16143035888672],[58.599327087402344,16.16179084777832],[58.59829330444336,16.165029525756836],[58.59823226928711,16.16520118713379],[58.59819412231445,16.165287017822266],[58.598114013671875,16.1654052734375],[58.5980339050293,16.165525436401367],[58.597599029541016,16.166072845458984],[58.59745788574219,16.16619110107422],[58.596961975097656,16.166444778442383],[58.59406661987305,16.167943954467773],[58.59394073486328,16.168046951293945],[58.59388732910156,16.168115615844727],[58.593849182128906,16.16819953918457],[58.59382247924805,16.168371200561523],[58.593814849853516,16.16849136352539],[58.59382247924805,16.168577194213867],[58.593929290771484,16.169164657592773],[58.59400939941406,16.169645309448242],[58.594749450683594,16.174882888793945],[58.594905853271484,16.1760196685791],[58.595054626464844,16.177017211914062],[58.59553909301758,16.18042755126953],[58.5955924987793,16.1806697845459],[58.59577178955078,16.181238174438477],[58.5958251953125,16.181446075439453],[58.59602737426758,16.182857513427734],[58.59609603881836,16.183391571044922],[58.59612274169922,16.183616638183594],[58.59612274169922,16.18370246887207],[58.59610366821289,16.183839797973633],[58.5960693359375,16.183975219726562],[58.596031188964844,16.184045791625977],[58.595985412597656,16.18409538269043],[58.595943450927734,16.18412971496582],[58.59571838378906,16.18426513671875],[58.59444046020508,16.184904098510742],[58.59294509887695,16.185834884643555],[58.59234619140625,16.186153411865234],[58.591732025146484,16.18645668029785],[58.59132766723633,16.186641693115234],[58.587928771972656,16.18837547302246],[58.587894439697266,16.188392639160156],[58.587623596191406,16.188562393188477],[58.5862922668457,16.189252853393555],[58.58606719970703,16.1893367767334],[58.585655212402344,16.18955421447754],[58.58552932739258,16.189605712890625],[58.58546447753906,16.189638137817383],[58.58542251586914,16.189638137817383],[58.58536911010742,16.189603805541992],[58.585330963134766,16.189550399780273],[58.585304260253906,16.189481735229492],[58.585289001464844,16.189395904541016],[58.58527755737305,16.189292907714844],[58.585289001464844,16.18915557861328],[58.58533477783203,16.18879508972168],[58.58538818359375,16.188159942626953],[58.585975646972656,16.181289672851562],[58.5860595703125,16.180137634277344],[58.58634948730469,16.176788330078125],[58.586448669433594,16.17560386657715],[58.586544036865234,16.17467498779297],[58.58678436279297,16.17184066772461],[58.58678436279297,16.17154884338379],[58.58675765991211,16.171255111694336],[58.5865364074707,16.169878005981445],[58.586280822753906,16.16829490661621],[58.586124420166016,16.16750144958496],[58.58587646484375,16.16641616821289],[58.5851936340332,16.163177490234375],[58.5851936340332,16.16314125061035],[58.58512878417969,16.162918090820312],[58.585060119628906,16.162744522094727],[58.5849609375,16.16259002685547],[58.584815979003906,16.162450790405273],[58.58161163330078,16.159770965576172],[58.581539154052734,16.159683227539062],[58.581478118896484,16.15958023071289],[58.581424713134766,16.159408569335938],[58.58126449584961,16.15880584716797],[58.581199645996094,16.1585636138916],[58.581058502197266,16.15814971923828],[58.58064651489258,16.157182693481445],[58.58018493652344,16.156164169311523],[58.579872131347656,16.155420303344727],[58.57966613769531,16.15488624572754],[58.579559326171875,16.15460968017578],[58.57846450805664,16.15200424194336],[58.578250885009766,16.151416778564453],[58.57809829711914,16.150968551635742],[58.578033447265625,16.150728225708008],[58.5779914855957,16.15045166015625],[58.57798385620117,16.1502628326416],[58.57797622680664,16.149730682373047],[58.57797622680664,16.149368286132812],[58.57798767089844,16.14916229248047],[58.57802200317383,16.149009704589844],[58.57807540893555,16.148906707763672],[58.578147888183594,16.1488037109375],[58.57863235473633,16.148258209228516],[58.579524993896484,16.147253036499023],[58.57965087890625,16.147064208984375],[58.579689025878906,16.1469783782959],[58.579715728759766,16.146894454956055],[58.57975387573242,16.14668846130371],[58.57975387573242,16.146516799926758],[58.579742431640625,16.14630889892578],[58.579654693603516,16.145896911621094],[58.57883834838867,16.141830444335938],[58.578460693359375,16.140005111694336],[58.57832717895508,16.13931655883789],[58.57828140258789,16.138973236083984],[58.57822036743164,16.138404846191406],[58.57815170288086,16.137664794921875],[58.57809829711914,16.13726806640625],[58.57746124267578,16.133670806884766],[58.577335357666016,16.1330509185791],[58.57716751098633,16.13234519958496],[58.57670593261719,16.130329132080078],[58.57650375366211,16.12938117980957],[58.57646560668945,16.12908935546875],[58.57645797729492,16.12828254699707],[58.57643127441406,16.128005981445312],[58.57639694213867,16.127782821655273],[58.57632827758789,16.127506256103516],[58.576255798339844,16.12726593017578],[58.5761833190918,16.127092361450195],[58.576114654541016,16.126937866210938],[58.575862884521484,16.1264705657959],[58.57561111450195,16.126022338867188],[58.57548522949219,16.12581443786621],[58.575504302978516,16.125797271728516]],\"_eventId\":\"4868ad61-5edb-4e0b-b827-fac49b6ee2a0\",\"_eventType\":\"oi/current_vehicle_journey/details\",\"_sequenceNumber\":6}";
    const GPT_EXPECTED_CALLS_MQTT_MSG: &str = "{\"updatedAtDateTime\":\"2023-01-12T07:36:05Z\",\"vehicleJourneyRef\":\"9015005000300056\",\"callSequenceNumber\":2,\"pointRef\":\"9022005001034017\",\"atStop\":true,\"estimatedTimeOfArrival\":\"2023-01-12T08:35:47Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:35:47Z\",\"serviceDeviation\":56,\"previousCall\":{\"callSequenceNumber\":1,\"pointRef\":\"9022005000010017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:33:52Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:34:56Z\",\"restriction\":\"UNKNOWN\"},\"laterCalls\":[{\"callSequenceNumber\":3,\"pointRef\":\"9022005001033017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:36:35Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:36:45Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":4,\"pointRef\":\"9022005001032017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:37:57Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:38:04Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":5,\"pointRef\":\"9022005000009017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:39:02Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:39:07Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":6,\"pointRef\":\"9022005001031017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:40:10Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:40:14Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":7,\"pointRef\":\"9022005001030017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:40:51Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:40:56Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":8,\"pointRef\":\"9022005001029017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:42:20Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:42:29Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":9,\"pointRef\":\"9022005001027017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:43:51Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:43:58Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":10,\"pointRef\":\"9022005000008017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:45:15Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:45:27Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":11,\"pointRef\":\"9022005000003019\",\"estimatedTimeOfArrival\":\"2023-01-12T08:48:36Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:50:00Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":12,\"pointRef\":\"9022005000011017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:51:18Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:51:35Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":13,\"pointRef\":\"9022005000005017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:53:08Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:53:21Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":14,\"pointRef\":\"9022005001000017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:54:53Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:55:09Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":15,\"pointRef\":\"9022005000001017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:56:07Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:56:47Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":16,\"pointRef\":\"9022005001002017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:57:50Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:57:57Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":17,\"pointRef\":\"9022005001020017\",\"estimatedTimeOfArrival\":\"2023-01-12T08:59:04Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T08:59:10Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":18,\"pointRef\":\"9022005000006017\",\"estimatedTimeOfArrival\":\"2023-01-12T09:00:13Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T09:00:44Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":19,\"pointRef\":\"9022005001037017\",\"estimatedTimeOfArrival\":\"2023-01-12T09:01:36Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T09:01:46Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":20,\"pointRef\":\"9022005001038017\",\"estimatedTimeOfArrival\":\"2023-01-12T09:02:45Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T09:02:48Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":21,\"pointRef\":\"9022005001039017\",\"estimatedTimeOfArrival\":\"2023-01-12T09:03:47Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T09:03:50Z\",\"restriction\":\"UNKNOWN\"},{\"callSequenceNumber\":22,\"pointRef\":\"9022005000012017\",\"estimatedTimeOfArrival\":\"2023-01-12T09:04:28Z\",\"estimatedTimeOfDeparture\":\"2023-01-12T09:06:16Z\",\"restriction\":\"UNKNOWN\"}],\"gtfsTripId\":\"55700000066533349\",\"_eventId\":\"4014df07-f2c5-4c81-9d38-bdce9a959737\",\"_eventType\":\"oi/current_vehicle_journey/expected_call\",\"_sequenceNumber\":224}";
    

}


